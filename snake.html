<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è´ªåƒè›‡</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        font-family: 'Arial', sans-serif;
        padding: 20px;
      }

      .game-container {
        display: flex;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .sidebar {
        width: 250px;
        padding: 30px;
        background: linear-gradient(180deg, #f5f5f5 0%, #e8e8e8 100%);
        display: flex;
        flex-direction: column;
        border-right: 2px solid #ddd;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .controls {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
        line-height: 1.6;
      }

      .score-board {
        margin-top: auto;
        font-size: 16px;
        font-weight: bold;
      }

      .score-item {
        color: #333;
        margin-bottom: 10px;
      }

      .game-area {
        flex: 1;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      canvas {
        border: 3px solid #333;
        border-radius: 5px;
        display: block;
        background: #1a1a2e;
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 40px 60px;
        border-radius: 15px;
        font-size: 24px;
        text-align: center;
        display: none;
        z-index: 1000;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border: 3px solid #ffd700;
      }

      .game-over button {
        margin-top: 20px;
        padding: 10px 30px;
        font-size: 18px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.3s;
      }

      .game-over button:hover {
        background: #45a049;
      }

      .pause-overlay {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 30px 50px;
        border-radius: 15px;
        font-size: 24px;
        text-align: center;
        display: none;
        z-index: 999;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="sidebar">
        <h1>ğŸ è´ªåƒè›‡</h1>
        <div class="controls">
          <strong>æ“ä½œè¯´æ˜ï¼š</strong><br />
          æ–¹å‘é”® â†‘ â†“ â† â†’ æ§åˆ¶ç§»åŠ¨<br />
          ç©ºæ ¼é”® æš‚åœ/ç»§ç»­
        </div>
        <div class="score-board">
          <div class="score-item">å¾—åˆ†: <span id="score">0</span></div>
          <div class="score-item">æœ€é«˜åˆ†: <span id="highScore">0</span></div>
          <div class="score-item">é•¿åº¦: <span id="length">1</span></div>
          <div class="score-item">ç”Ÿå‘½: <span id="lives">50</span></div>
        </div>
      </div>
      <div class="game-area">
        <canvas id="gameCanvas" width="700" height="700"></canvas>
      </div>
    </div>
    <div id="gameOver" class="game-over">
      <div>æ¸¸æˆç»“æŸï¼</div>
      <div style="font-size: 18px; margin-top: 10px">æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></div>
      <button onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    </div>
    <div id="pauseOverlay" class="pause-overlay">
      <div>â¸ï¸ æ¸¸æˆæš‚åœ</div>
      <div style="font-size: 16px; margin-top: 10px">æŒ‰ç©ºæ ¼é”®ç»§ç»­</div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      canvas.width = 700;
      canvas.height = 700;
      const ctx = canvas.getContext('2d');
      const scoreElement = document.getElementById('score');
      const highScoreElement = document.getElementById('highScore');
      const lengthElement = document.getElementById('length');
      const livesElement = document.getElementById('lives');
      const gameOverElement = document.getElementById('gameOver');
      const pauseOverlayElement = document.getElementById('pauseOverlay');
      const finalScoreElement = document.getElementById('finalScore');

      // æ¸¸æˆé…ç½®
      const gridSize = 20; // ç½‘æ ¼å¤§å°
      const tileCount = canvas.width / gridSize;

      // æ¸¸æˆçŠ¶æ€
      let snake = [{ x: 10, y: 10 }];
      let food = {};
      let dx = 0;
      let dy = 0;
      let score = 0;
      let lives = 50;
      let gameRunning = false;
      let gamePaused = false;
      let gameLoopId = null;

      // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æœ€é«˜åˆ†
      let highScore = parseInt(localStorage.getItem('snakeHighScore') || '0');
      highScoreElement.textContent = highScore;

      // éŸ³æ•ˆç³»ç»Ÿ
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      let audioEnabled = false;

      function enableAudio() {
        if (!audioEnabled) {
          audioContext.resume();
          audioEnabled = true;
        }
      }

      function playSound(frequency, duration, type = 'sine', volume = 0.2) {
        if (!audioEnabled) return;
        try {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;
          gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
          // å¿½ç•¥éŸ³é¢‘é”™è¯¯
        }
      }

      function playEatSound() {
        playSound(440, 0.1, 'sine', 0.25);
        setTimeout(() => playSound(554, 0.1, 'sine', 0.2), 50);
        setTimeout(() => playSound(659, 0.15, 'sine', 0.15), 100);
      }

      function playLoseLifeSound() {
        playSound(200, 0.2, 'sawtooth', 0.3);
      }

      function playGameOverSound() {
        playSound(300, 0.3, 'sawtooth', 0.4);
        setTimeout(() => playSound(250, 0.3, 'sawtooth', 0.4), 200);
        setTimeout(() => playSound(200, 0.4, 'sawtooth', 0.4), 400);
      }

      // ç”Ÿæˆé£Ÿç‰©
      function generateFood() {
        food = {
          x: Math.floor(Math.random() * tileCount),
          y: Math.floor(Math.random() * tileCount),
        };
        // ç¡®ä¿é£Ÿç‰©ä¸åœ¨è›‡èº«ä¸Š
        for (let segment of snake) {
          if (segment.x === food.x && segment.y === food.y) {
            generateFood();
            return;
          }
        }
      }

      // ç»˜åˆ¶æ¸¸æˆ
      function drawGame() {
        // æ¸…ç©ºç”»å¸ƒ
        ctx.fillStyle = '#1a1a2e';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // ç»˜åˆ¶ç½‘æ ¼
        ctx.strokeStyle = '#16213e';
        ctx.lineWidth = 1;
        for (let i = 0; i <= tileCount; i++) {
          ctx.beginPath();
          ctx.moveTo(i * gridSize, 0);
          ctx.lineTo(i * gridSize, canvas.height);
          ctx.stroke();
          ctx.beginPath();
          ctx.moveTo(0, i * gridSize);
          ctx.lineTo(canvas.width, i * gridSize);
          ctx.stroke();
        }

        // ç»˜åˆ¶è›‡
        ctx.fillStyle = '#4CAF50';
        for (let i = 0; i < snake.length; i++) {
          const segment = snake[i];
          // è›‡å¤´ç”¨ä¸åŒé¢œè‰²
          if (i === 0) {
            ctx.fillStyle = '#66BB6A';
          } else {
            ctx.fillStyle = '#4CAF50';
          }
          ctx.fillRect(
            segment.x * gridSize + 1,
            segment.y * gridSize + 1,
            gridSize - 2,
            gridSize - 2,
          );
          // è›‡å¤´çœ¼ç›
          if (i === 0) {
            ctx.fillStyle = '#000';
            const eyeSize = 3;
            if (dx === 1) {
              // å‘å³
              ctx.fillRect(
                segment.x * gridSize + gridSize - 6,
                segment.y * gridSize + 5,
                eyeSize,
                eyeSize,
              );
              ctx.fillRect(
                segment.x * gridSize + gridSize - 6,
                segment.y * gridSize + 12,
                eyeSize,
                eyeSize,
              );
            } else if (dx === -1) {
              // å‘å·¦
              ctx.fillRect(segment.x * gridSize + 3, segment.y * gridSize + 5, eyeSize, eyeSize);
              ctx.fillRect(segment.x * gridSize + 3, segment.y * gridSize + 12, eyeSize, eyeSize);
            } else if (dy === 1) {
              // å‘ä¸‹
              ctx.fillRect(
                segment.x * gridSize + 5,
                segment.y * gridSize + gridSize - 6,
                eyeSize,
                eyeSize,
              );
              ctx.fillRect(
                segment.x * gridSize + 12,
                segment.y * gridSize + gridSize - 6,
                eyeSize,
                eyeSize,
              );
            } else if (dy === -1) {
              // å‘ä¸Š
              ctx.fillRect(segment.x * gridSize + 5, segment.y * gridSize + 3, eyeSize, eyeSize);
              ctx.fillRect(segment.x * gridSize + 12, segment.y * gridSize + 3, eyeSize, eyeSize);
            }
          }
        }

        // ç»˜åˆ¶é£Ÿç‰©
        ctx.fillStyle = '#FF5722';
        ctx.beginPath();
        ctx.arc(
          food.x * gridSize + gridSize / 2,
          food.y * gridSize + gridSize / 2,
          gridSize / 2 - 2,
          0,
          Math.PI * 2,
        );
        ctx.fill();
        // é£Ÿç‰©é«˜å…‰
        ctx.fillStyle = '#FF8A65';
        ctx.beginPath();
        ctx.arc(
          food.x * gridSize + gridSize / 2 - 3,
          food.y * gridSize + gridSize / 2 - 3,
          4,
          0,
          Math.PI * 2,
        );
        ctx.fill();
      }

      // æ›´æ–°æ¸¸æˆçŠ¶æ€
      function updateGame() {
        if (!gameRunning || gamePaused) return;

        // å¦‚æœæ–¹å‘æœªè®¾ç½®ï¼Œä¸ç§»åŠ¨
        if (dx === 0 && dy === 0) return;

        const head = { x: snake[0].x + dx, y: snake[0].y + dy };

        // æ£€æŸ¥å¢™å£ç¢°æ’
        if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
          lives--;
          livesElement.textContent = lives;
          playLoseLifeSound();
          if (lives <= 0) {
            gameOver();
            return;
          }
          // é‡ç½®è›‡çš„ä½ç½®
          snake = [{ x: 10, y: 10 }];
          dx = 0;
          dy = 0;
          return;
        }

        // æ£€æŸ¥è‡ªèº«ç¢°æ’
        for (let segment of snake) {
          if (head.x === segment.x && head.y === segment.y) {
            lives--;
            livesElement.textContent = lives;
            playLoseLifeSound();
            if (lives <= 0) {
              gameOver();
              return;
            }
            // é‡ç½®è›‡çš„ä½ç½®
            snake = [{ x: 10, y: 10 }];
            dx = 0;
            dy = 0;
            return;
          }
        }

        snake.unshift(head);

        // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
        if (head.x === food.x && head.y === food.y) {
          score += 10;
          scoreElement.textContent = score;
          lengthElement.textContent = snake.length;
          playEatSound();
          generateFood();

          // æ›´æ–°æœ€é«˜åˆ†
          if (score > highScore) {
            highScore = score;
            highScoreElement.textContent = highScore;
            localStorage.setItem('snakeHighScore', highScore.toString());
          }
        } else {
          snake.pop();
        }

        drawGame();
      }

      // æ¸¸æˆç»“æŸ
      function gameOver() {
        gameRunning = false;
        gamePaused = false;
        clearInterval(gameLoopId);
        playGameOverSound();
        finalScoreElement.textContent = score;
        gameOverElement.style.display = 'block';
        pauseOverlayElement.style.display = 'none';
      }

      // é‡æ–°å¼€å§‹æ¸¸æˆ
      function restartGame() {
        snake = [{ x: 10, y: 10 }];
        dx = 0;
        dy = 0;
        score = 0;
        lives = 50;
        gameRunning = true;
        gamePaused = false;
        scoreElement.textContent = score;
        lengthElement.textContent = snake.length;
        livesElement.textContent = lives;
        gameOverElement.style.display = 'none';
        pauseOverlayElement.style.display = 'none';
        generateFood();
        drawGame();
        startGameLoop();
      }

      // å¼€å§‹æ¸¸æˆå¾ªç¯
      function startGameLoop() {
        if (gameLoopId) clearInterval(gameLoopId);
        gameLoopId = setInterval(updateGame, 400); // å‡æ…¢é€Ÿåº¦ï¼š250msï¼Œæ›´å®¹æ˜“æ§åˆ¶
      }

      // æš‚åœ/ç»§ç»­æ¸¸æˆ
      function togglePause() {
        if (!gameRunning) return;
        gamePaused = !gamePaused;
        if (gamePaused) {
          pauseOverlayElement.style.display = 'block';
          clearInterval(gameLoopId);
        } else {
          pauseOverlayElement.style.display = 'none';
          startGameLoop();
        }
      }

      // é”®ç›˜æ§åˆ¶
      document.addEventListener('keydown', (e) => {
        enableAudio();

        if (!gameRunning && e.code !== 'Space') {
          // æ¸¸æˆæœªå¼€å§‹æ—¶ï¼ŒæŒ‰ä»»æ„æ–¹å‘é”®å¼€å§‹
          if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.code)) {
            restartGame();
          }
        }

        if (e.code === 'Space') {
          e.preventDefault();
          if (gameRunning) {
            togglePause();
          } else {
            restartGame();
          }
          return;
        }

        if (gamePaused) return;

        // é˜²æ­¢åå‘ç§»åŠ¨
        if (e.code === 'ArrowUp' && dy !== 1) {
          dx = 0;
          dy = -1;
        } else if (e.code === 'ArrowDown' && dy !== -1) {
          dx = 0;
          dy = 1;
        } else if (e.code === 'ArrowLeft' && dx !== 1) {
          dx = -1;
          dy = 0;
        } else if (e.code === 'ArrowRight' && dx !== -1) {
          dx = 1;
          dy = 0;
        }
      });

      // ç‚¹å‡»äº‹ä»¶æ¿€æ´»éŸ³é¢‘
      document.addEventListener('click', enableAudio, { once: true });

      // åˆå§‹åŒ–æ¸¸æˆ
      generateFood();
      drawGame();

      // æ˜¾ç¤ºå¼€å§‹æç¤º
      setTimeout(() => {
        if (!gameRunning) {
          pauseOverlayElement.innerHTML =
            '<div>ğŸ è´ªåƒè›‡</div><div style="font-size: 16px; margin-top: 10px">æŒ‰æ–¹å‘é”®å¼€å§‹æ¸¸æˆ</div>';
          pauseOverlayElement.style.display = 'block';
        }
      }, 100);
    </script>
  </body>
</html>
