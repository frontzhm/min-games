<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¿„ç½—æ–¯æ–¹å—</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: 'Arial', sans-serif;
        padding: 20px;
      }

      .game-container {
        background: #fff;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        display: flex;
        gap: 30px;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 20px;
        font-size: 32px;
      }

      .game-board {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      canvas {
        border: 4px solid #333;
        border-radius: 5px;
        display: block;
        background: #000;
      }

      .controls {
        text-align: center;
        color: #666;
        margin-top: 15px;
        font-size: 14px;
        line-height: 1.8;
      }

      .info-panel {
        display: flex;
        flex-direction: column;
        gap: 20px;
        min-width: 200px;
      }

      .info-box {
        background: #f5f5f5;
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #ddd;
      }

      .info-box h3 {
        color: #333;
        margin-bottom: 10px;
        font-size: 18px;
        text-align: center;
      }

      .info-item {
        margin: 8px 0;
        font-size: 16px;
        color: #555;
      }

      .info-item span {
        font-weight: bold;
        color: #667eea;
      }

      .next-piece {
        background: #000;
        border: 2px solid #333;
        border-radius: 5px;
        width: 120px;
        height: 120px;
        margin: 10px auto;
      }

      .button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: transform 0.2s;
        width: 100%;
        margin-top: 10px;
      }

      .button:hover {
        transform: scale(1.05);
      }

      .button:active {
        transform: scale(0.95);
      }

      .game-over {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 40px 60px;
        border-radius: 15px;
        font-size: 24px;
        text-align: center;
        display: none;
        z-index: 1000;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border: 3px solid #ffd700;
      }

      .game-over h2 {
        margin-bottom: 20px;
        font-size: 32px;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="game-board">
        <h1>ğŸ® ä¿„ç½—æ–¯æ–¹å—</h1>
        <canvas id="gameCanvas" width="400" height="650"></canvas>
        <div class="controls">
          <div>â† â†’ ç§»åŠ¨ | â†‘ æ—‹è½¬ | â†“ åŠ é€Ÿä¸‹é™</div>
          <div>ç©ºæ ¼é”® ç›´æ¥è½ä¸‹ | P æš‚åœ/ç»§ç»­</div>
        </div>
      </div>

      <div class="info-panel">
        <div class="info-box">
          <h3>æ¸¸æˆä¿¡æ¯</h3>
          <div class="info-item">å¾—åˆ†: <span id="score">0</span></div>
          <div class="info-item">ç­‰çº§: <span id="level">1</span></div>
          <div class="info-item">è¡Œæ•°: <span id="lines">0</span></div>
          <div class="info-item">é€Ÿåº¦: <span id="speed">1</span></div>
        </div>

        <div class="info-box">
          <h3>ä¸‹ä¸€ä¸ª</h3>
          <canvas id="nextCanvas" class="next-piece" width="120" height="120"></canvas>
        </div>

        <button class="button" onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
        <button class="button" onclick="pauseGame()">æš‚åœ/ç»§ç»­</button>
        <button class="button" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
      </div>
    </div>

    <div id="gameOver" class="game-over">
      <h2>æ¸¸æˆç»“æŸï¼</h2>
      <div>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></div>
      <div style="margin-top: 20px; font-size: 16px">æŒ‰"é‡æ–°å¼€å§‹"æŒ‰é’®ç»§ç»­æ¸¸æˆ</div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      canvas.width = 400;
      canvas.height = 650;
      const ctx = canvas.getContext('2d');
      const nextCanvas = document.getElementById('nextCanvas');
      const nextCtx = nextCanvas.getContext('2d');

      // æ¸¸æˆçŠ¶æ€
      const COLS = 10;
      const ROWS = 20;
      const BLOCK_SIZE = 30;
      let board = [];
      let score = 0;
      let level = 1;
      let lines = 0;
      let gameRunning = false;
      let gamePaused = false;
      let dropTime = 0;
      let lastTime = 0;
      let dropInterval = 1000;

      // æ–¹å—ç±»å‹å®šä¹‰ï¼ˆ7ç§ç»å…¸ä¿„ç½—æ–¯æ–¹å—ï¼‰
      const SHAPES = [
        [
          [0, 0, 0, 0],
          [1, 1, 1, 1],
          [0, 0, 0, 0],
          [0, 0, 0, 0],
        ], // I
        [
          [1, 1],
          [1, 1],
        ], // O
        [
          [0, 1, 0],
          [1, 1, 1],
          [0, 0, 0],
        ], // T
        [
          [0, 1, 1],
          [1, 1, 0],
          [0, 0, 0],
        ], // S
        [
          [1, 1, 0],
          [0, 1, 1],
          [0, 0, 0],
        ], // Z
        [
          [1, 0, 0],
          [1, 1, 1],
          [0, 0, 0],
        ], // L
        [
          [0, 0, 1],
          [1, 1, 1],
          [0, 0, 0],
        ], // J
      ];

      // æ–¹å—é¢œè‰²
      const COLORS = [
        '#00f0f0', // I - é’è‰²
        '#f0f000', // O - é»„è‰²
        '#a000f0', // T - ç´«è‰²
        '#00f000', // S - ç»¿è‰²
        '#f00000', // Z - çº¢è‰²
        '#f0a000', // L - æ©™è‰²
        '#0000f0', // J - è“è‰²
      ];

      // å½“å‰æ–¹å—å’Œä¸‹ä¸€ä¸ªæ–¹å—
      let currentPiece = null;
      let nextPiece = null;

      // åˆå§‹åŒ–æ¸¸æˆæ¿
      function initBoard() {
        board = [];
        for (let r = 0; r < ROWS; r++) {
          board[r] = [];
          for (let c = 0; c < COLS; c++) {
            board[r][c] = 0;
          }
        }
      }

      // åˆ›å»ºæ–°æ–¹å—
      function createPiece() {
        const type = Math.floor(Math.random() * SHAPES.length);
        return {
          shape: SHAPES[type],
          color: COLORS[type],
          x: Math.floor(COLS / 2) - 1,
          y: 0,
        };
      }

      // ç»˜åˆ¶å•ä¸ªæ–¹å—
      function drawBlock(x, y, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
        ctx.strokeStyle = '#333';
        ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
      }

      // ç»˜åˆ¶æ¸¸æˆæ¿
      function drawBoard() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        for (let r = 0; r < ROWS; r++) {
          for (let c = 0; c < COLS; c++) {
            if (board[r][c]) {
              drawBlock(c, r, board[r][c]);
            }
          }
        }
      }

      // ç»˜åˆ¶å½“å‰æ–¹å—
      function drawPiece(piece) {
        if (!piece) return;
        for (let r = 0; r < piece.shape.length; r++) {
          for (let c = 0; c < piece.shape[r].length; c++) {
            if (piece.shape[r][c]) {
              drawBlock(piece.x + c, piece.y + r, piece.color);
            }
          }
        }
      }

      // ç»˜åˆ¶ä¸‹ä¸€ä¸ªæ–¹å—é¢„è§ˆ
      function drawNextPiece() {
        nextCtx.fillStyle = '#000';
        nextCtx.fillRect(0, 0, nextCanvas.width, nextCanvas.height);

        if (!nextPiece) return;

        const offsetX = (nextCanvas.width / BLOCK_SIZE - nextPiece.shape[0].length) / 2;
        const offsetY = (nextCanvas.height / BLOCK_SIZE - nextPiece.shape.length) / 2;

        for (let r = 0; r < nextPiece.shape.length; r++) {
          for (let c = 0; c < nextPiece.shape[r].length; c++) {
            if (nextPiece.shape[r][c]) {
              const x = (offsetX + c) * BLOCK_SIZE;
              const y = (offsetY + r) * BLOCK_SIZE;
              nextCtx.fillStyle = nextPiece.color;
              nextCtx.fillRect(x, y, BLOCK_SIZE - 2, BLOCK_SIZE - 2);
              nextCtx.strokeStyle = '#333';
              nextCtx.strokeRect(x, y, BLOCK_SIZE - 2, BLOCK_SIZE - 2);
            }
          }
        }
      }

      // æ£€æŸ¥ç¢°æ’
      function isValidMove(piece, dx = 0, dy = 0, newShape = null) {
        const shape = newShape || piece.shape;
        const newX = piece.x + dx;
        const newY = piece.y + dy;

        for (let r = 0; r < shape.length; r++) {
          for (let c = 0; c < shape[r].length; c++) {
            if (shape[r][c]) {
              const x = newX + c;
              const y = newY + r;

              // æ£€æŸ¥è¾¹ç•Œ
              if (x < 0 || x >= COLS || y >= ROWS) {
                return false;
              }

              // æ£€æŸ¥ä¸å·²æ”¾ç½®æ–¹å—çš„ç¢°æ’
              if (y >= 0 && board[y][x]) {
                return false;
              }
            }
          }
        }
        return true;
      }

      // æ—‹è½¬æ–¹å—
      function rotatePiece(piece) {
        const rotated = [];
        const size = piece.shape.length;

        for (let c = 0; c < size; c++) {
          rotated[c] = [];
          for (let r = size - 1; r >= 0; r--) {
            rotated[c][size - 1 - r] = piece.shape[r][c];
          }
        }

        return rotated;
      }

      // æ”¾ç½®æ–¹å—åˆ°æ¸¸æˆæ¿
      function placePiece(piece) {
        for (let r = 0; r < piece.shape.length; r++) {
          for (let c = 0; c < piece.shape[r].length; c++) {
            if (piece.shape[r][c]) {
              const y = piece.y + r;
              const x = piece.x + c;
              if (y >= 0) {
                board[y][x] = piece.color;
              }
            }
          }
        }
      }

      // æ¸…é™¤å®Œæ•´çš„è¡Œ
      function clearLines() {
        let linesCleared = 0;

        for (let r = ROWS - 1; r >= 0; r--) {
          if (board[r].every((cell) => cell !== 0)) {
            board.splice(r, 1);
            board.unshift(new Array(COLS).fill(0));
            linesCleared++;
            r++; // é‡æ–°æ£€æŸ¥è¿™ä¸€è¡Œ
          }
        }

        if (linesCleared > 0) {
          lines += linesCleared;
          // è®¡åˆ†ï¼šæ¶ˆé™¤çš„è¡Œæ•°è¶Šå¤šï¼Œå¾—åˆ†è¶Šé«˜
          const points = [0, 100, 300, 500, 800];
          score += points[linesCleared] * level;
          level = Math.floor(lines / 10) + 1;
          dropInterval = Math.max(100, 1000 - (level - 1) * 100);

          document.getElementById('score').textContent = score;
          document.getElementById('level').textContent = level;
          document.getElementById('lines').textContent = lines;
          document.getElementById('speed').textContent = level;
        }
      }

      // æ£€æŸ¥æ¸¸æˆç»“æŸ
      function checkGameOver() {
        if (currentPiece && !isValidMove(currentPiece)) {
          gameRunning = false;
          document.getElementById('finalScore').textContent = score;
          document.getElementById('gameOver').style.display = 'block';
          return true;
        }
        return false;
      }

      // ç§»åŠ¨æ–¹å—
      function movePiece(dx, dy) {
        if (!currentPiece || !gameRunning || gamePaused) return;

        if (isValidMove(currentPiece, dx, dy)) {
          currentPiece.x += dx;
          currentPiece.y += dy;
          return true;
        }
        return false;
      }

      // æ—‹è½¬å½“å‰æ–¹å—
      function rotateCurrentPiece() {
        if (!currentPiece || !gameRunning || gamePaused) return;

        const rotated = rotatePiece(currentPiece);
        if (isValidMove(currentPiece, 0, 0, rotated)) {
          currentPiece.shape = rotated;
        }
      }

      // ç¡¬é™ï¼ˆç›´æ¥è½åˆ°åº•éƒ¨ï¼‰
      function hardDrop() {
        if (!currentPiece || !gameRunning || gamePaused) return;

        while (movePiece(0, 1)) {
          // ç»§ç»­ä¸‹é™
        }
        placePiece(currentPiece);
        clearLines();
        currentPiece = nextPiece;
        nextPiece = createPiece();
        drawNextPiece();

        if (checkGameOver()) {
          return;
        }
      }

      // ä¸‹é™æ–¹å—
      function dropPiece() {
        if (!currentPiece || !gameRunning || gamePaused) return;

        if (!movePiece(0, 1)) {
          placePiece(currentPiece);
          clearLines();
          currentPiece = nextPiece;
          nextPiece = createPiece();
          drawNextPiece();

          if (checkGameOver()) {
            return;
          }
        }
      }

      // é”®ç›˜æ§åˆ¶
      document.addEventListener('keydown', (e) => {
        if (!gameRunning) return;

        switch (e.code) {
          case 'ArrowLeft':
            e.preventDefault();
            movePiece(-1, 0);
            break;
          case 'ArrowRight':
            e.preventDefault();
            movePiece(1, 0);
            break;
          case 'ArrowDown':
            e.preventDefault();
            dropPiece();
            break;
          case 'ArrowUp':
            e.preventDefault();
            rotateCurrentPiece();
            break;
          case 'Space':
            e.preventDefault();
            hardDrop();
            break;
          case 'KeyP':
            e.preventDefault();
            pauseGame();
            break;
        }
      });

      // æ¸¸æˆå¾ªç¯
      function gameLoop(time = 0) {
        if (!gameRunning) return;

        const deltaTime = time - lastTime;
        lastTime = time;

        if (!gamePaused) {
          dropTime += deltaTime;

          if (dropTime > dropInterval) {
            dropPiece();
            dropTime = 0;
          }

          drawBoard();
          if (currentPiece) {
            drawPiece(currentPiece);
          }
        }

        requestAnimationFrame(gameLoop);
      }

      // å¼€å§‹æ¸¸æˆ
      function startGame() {
        if (gameRunning) return;

        initBoard();
        score = 0;
        level = 1;
        lines = 0;
        dropTime = 0;
        lastTime = 0;
        dropInterval = 1000;
        gameRunning = true;
        gamePaused = false;

        currentPiece = createPiece();
        nextPiece = createPiece();
        drawNextPiece();

        document.getElementById('score').textContent = score;
        document.getElementById('level').textContent = level;
        document.getElementById('lines').textContent = lines;
        document.getElementById('speed').textContent = level;
        document.getElementById('gameOver').style.display = 'none';

        gameLoop();
      }

      // æš‚åœæ¸¸æˆ
      function pauseGame() {
        if (!gameRunning) return;
        gamePaused = !gamePaused;
      }

      // é‡ç½®æ¸¸æˆ
      function resetGame() {
        gameRunning = false;
        gamePaused = false;
        document.getElementById('gameOver').style.display = 'none';
        startGame();
      }

      // åˆå§‹åŒ–
      initBoard();
      drawBoard();
    </script>
  </body>
</html>

