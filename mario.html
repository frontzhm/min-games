<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è¶…çº§ç›ä¸½ç®€å•ç‰ˆ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #87ceeb 0%, #98d8e8 100%);
        font-family: 'Arial', sans-serif;
        padding: 20px;
      }

      .game-container {
        display: flex;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
      }

      .sidebar {
        width: 250px;
        padding: 30px;
        background: linear-gradient(180deg, #f5f5f5 0%, #e8e8e8 100%);
        display: flex;
        flex-direction: column;
        border-right: 2px solid #ddd;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .controls {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
        line-height: 1.6;
      }

      .score {
        margin-top: auto;
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

      .level-info {
        font-size: 16px;
        color: #666;
        margin-bottom: 20px;
      }

      .game-area {
        flex: 1;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      canvas {
        border: 3px solid #333;
        border-radius: 5px;
        display: block;
        background: #87ceeb;
      }

      .level-complete {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 40px 60px;
        border-radius: 15px;
        font-size: 28px;
        text-align: center;
        display: none;
        z-index: 1000;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        border: 3px solid #ffd700;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <div class="sidebar">
        <h1>ğŸ® è¶…çº§ç›ä¸½ç®€å•ç‰ˆ</h1>
        <div class="controls">
          <strong>æ“ä½œè¯´æ˜ï¼š</strong><br />
          â† â†’ ç§»åŠ¨<br />
          ç©ºæ ¼é”® è·³è·ƒ<br />
          ï¼ˆå°ç™½ç‚¹ï¼‰
        </div>
        <div class="score">
          <div>å¾—åˆ†: <span id="score">0</span></div>
          <div style="margin-top: 10px">ç”Ÿå‘½: <span id="lives">40</span></div>
        </div>
        <div class="level-info">
          å…³å¡: <span id="currentLevel">1</span> / <span id="totalLevels">5</span>
        </div>
      </div>
      <div class="game-area">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
      </div>
    </div>
    <div id="levelComplete" class="level-complete">
      <div>ğŸ‰ å…³å¡å®Œæˆï¼</div>
      <div style="font-size: 16px; margin-top: 10px">æŒ‰ä»»æ„é”®ç»§ç»­ä¸‹ä¸€å…³</div>
    </div>

    <script>
      const canvas = document.getElementById('gameCanvas');
      // è°ƒæ•´ç”»å¸ƒé«˜åº¦
      canvas.height = 600;
      const ctx = canvas.getContext('2d');
      const scoreElement = document.getElementById('score');
      const livesElement = document.getElementById('lives');
      const currentLevelElement = document.getElementById('currentLevel');
      const levelCompleteElement = document.getElementById('levelComplete');

      // éŸ³æ•ˆç³»ç»Ÿ
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();

      // æ’­æ”¾éŸ³æ•ˆçš„å‡½æ•°
      function playSound(frequency, duration, type = 'sine', volume = 0.3) {
        try {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();

          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = type;
          gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        } catch (e) {
          // å¦‚æœéŸ³é¢‘ä¸Šä¸‹æ–‡æœªæ¿€æ´»ï¼Œå¿½ç•¥é”™è¯¯
        }
      }

      // å„ç§éŸ³æ•ˆå‡½æ•°
      function playJumpSound() {
        // è·³è·ƒéŸ³æ•ˆï¼šçŸ­ä¿ƒçš„ä¸Šæ‰¬éŸ³è°ƒ
        playSound(400, 0.1, 'sine', 0.2);
        setTimeout(() => playSound(500, 0.1, 'sine', 0.15), 50);
      }

      function playCoinSound() {
        // é‡‘å¸éŸ³æ•ˆï¼šæ¸…è„†çš„ä¸Šå‡éŸ³è°ƒ
        playSound(523, 0.1, 'sine', 0.25); // C5
        setTimeout(() => playSound(659, 0.1, 'sine', 0.2), 50); // E5
        setTimeout(() => playSound(784, 0.15, 'sine', 0.15), 100); // G5
      }

      function playStompSound() {
        // è¸©æ•ŒäººéŸ³æ•ˆï¼šä½æ²‰çš„éŸ³è°ƒ
        playSound(200, 0.15, 'sawtooth', 0.3);
        setTimeout(() => playSound(150, 0.1, 'sawtooth', 0.2), 50);
      }

      function playHurtSound() {
        // å—ä¼¤éŸ³æ•ˆï¼šä¸‹é™çš„ä½éŸ³
        playSound(300, 0.2, 'sawtooth', 0.4);
        setTimeout(() => playSound(200, 0.2, 'sawtooth', 0.3), 100);
      }

      function playLevelCompleteSound() {
        // å…³å¡å®ŒæˆéŸ³æ•ˆï¼šèƒœåˆ©çš„æ—‹å¾‹
        playSound(523, 0.15, 'sine', 0.3); // C5
        setTimeout(() => playSound(659, 0.15, 'sine', 0.3), 150); // E5
        setTimeout(() => playSound(784, 0.15, 'sine', 0.3), 300); // G5
        setTimeout(() => playSound(1047, 0.3, 'sine', 0.35), 450); // C6
      }

      function playGameOverSound() {
        // æ¸¸æˆç»“æŸéŸ³æ•ˆï¼šä½æ²‰çš„ä¸‹é™éŸ³è°ƒ
        playSound(400, 0.3, 'sawtooth', 0.4);
        setTimeout(() => playSound(300, 0.3, 'sawtooth', 0.4), 200);
        setTimeout(() => playSound(200, 0.4, 'sawtooth', 0.4), 400);
      }

      // æ¿€æ´»éŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
      let audioEnabled = false;
      function enableAudio() {
        if (!audioEnabled) {
          audioContext.resume();
          audioEnabled = true;
        }
      }

      // åœ¨ç”¨æˆ·é¦–æ¬¡äº¤äº’æ—¶æ¿€æ´»éŸ³é¢‘
      document.addEventListener('keydown', enableAudio, { once: true });
      document.addEventListener('click', enableAudio, { once: true });

      // æ¸¸æˆçŠ¶æ€
      let score = 0;
      let lives = 40;
      let gameRunning = true;
      let currentLevel = 1;
      const totalLevels = 5;

      // ç©å®¶å¯¹è±¡
      const player = {
        x: 50,
        y: 300,
        width: 30,
        height: 40,
        velocityX: 0,
        velocityY: 0,
        speed: 1.5,
        jumpPower: -12,
        onGround: false,
        color: '#000000',
      };

      // å…³å¡æ•°æ®
      const levels = [
        // å…³å¡1ï¼šç®€å•å…¥é—¨
        {
          platforms: [
            { x: 0, y: 360, width: 200, height: 40 },
            { x: 250, y: 320, width: 150, height: 40 },
            { x: 450, y: 280, width: 150, height: 40 },
            { x: 650, y: 240, width: 150, height: 40 },
            { x: 0, y: 360, width: 800, height: 40 }, // åœ°é¢
          ],
          enemies: [
            { x: 300, y: 280, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 500, y: 240, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
          ],
          coins: [
            { x: 280, y: 280, width: 20, height: 20, collected: false },
            { x: 480, y: 240, width: 20, height: 20, collected: false },
            { x: 680, y: 200, width: 20, height: 20, collected: false },
          ],
          finishLine: { x: 750, y: 200, width: 30, height: 40 },
        },
        // å…³å¡2ï¼šæ›´å¤šæ•Œäºº
        {
          platforms: [
            { x: 0, y: 360, width: 150, height: 40 },
            { x: 200, y: 320, width: 120, height: 40 },
            { x: 370, y: 280, width: 120, height: 40 },
            { x: 540, y: 240, width: 120, height: 40 },
            { x: 700, y: 200, width: 100, height: 40 },
            { x: 0, y: 360, width: 800, height: 40 }, // åœ°é¢
          ],
          enemies: [
            { x: 250, y: 280, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 420, y: 240, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 590, y: 200, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 150, y: 320, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
          ],
          coins: [
            { x: 230, y: 280, width: 20, height: 20, collected: false },
            { x: 400, y: 240, width: 20, height: 20, collected: false },
            { x: 570, y: 200, width: 20, height: 20, collected: false },
            { x: 720, y: 160, width: 20, height: 20, collected: false },
          ],
          finishLine: { x: 750, y: 160, width: 30, height: 40 },
        },
        // å…³å¡3ï¼šå¤æ‚è·³è·ƒ
        {
          platforms: [
            { x: 0, y: 360, width: 120, height: 40 },
            { x: 150, y: 300, width: 100, height: 40 },
            { x: 270, y: 240, width: 100, height: 40 },
            { x: 400, y: 300, width: 100, height: 40 },
            { x: 530, y: 240, width: 100, height: 40 },
            { x: 660, y: 180, width: 140, height: 40 },
            { x: 0, y: 360, width: 800, height: 40 }, // åœ°é¢
          ],
          enemies: [
            { x: 190, y: 260, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 320, y: 200, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 450, y: 260, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
            { x: 580, y: 200, width: 25, height: 25, velocityX: -2, color: '#8B4513' },
          ],
          coins: [
            { x: 180, y: 260, width: 20, height: 20, collected: false },
            { x: 300, y: 200, width: 20, height: 20, collected: false },
            { x: 430, y: 260, width: 20, height: 20, collected: false },
            { x: 560, y: 200, width: 20, height: 20, collected: false },
            { x: 690, y: 140, width: 20, height: 20, collected: false },
          ],
          finishLine: { x: 750, y: 140, width: 30, height: 40 },
        },
        // å…³å¡4ï¼šé«˜éš¾åº¦
        {
          platforms: [
            { x: 0, y: 360, width: 80, height: 40 },
            { x: 130, y: 280, width: 70, height: 40 },
            { x: 250, y: 220, width: 70, height: 40 },
            { x: 370, y: 280, width: 70, height: 40 },
            { x: 490, y: 200, width: 70, height: 40 },
            { x: 610, y: 280, width: 70, height: 40 },
            { x: 730, y: 160, width: 70, height: 40 },
            { x: 0, y: 360, width: 800, height: 40 }, // åœ°é¢
          ],
          enemies: [
            { x: 180, y: 240, width: 25, height: 25, velocityX: -2.5, color: '#8B4513' },
            { x: 300, y: 180, width: 25, height: 25, velocityX: -2.5, color: '#8B4513' },
            { x: 420, y: 240, width: 25, height: 25, velocityX: -2.5, color: '#8B4513' },
            { x: 540, y: 160, width: 25, height: 25, velocityX: -2.5, color: '#8B4513' },
            { x: 660, y: 240, width: 25, height: 25, velocityX: -2.5, color: '#8B4513' },
          ],
          coins: [
            { x: 160, y: 240, width: 20, height: 20, collected: false },
            { x: 280, y: 180, width: 20, height: 20, collected: false },
            { x: 400, y: 240, width: 20, height: 20, collected: false },
            { x: 520, y: 160, width: 20, height: 20, collected: false },
            { x: 640, y: 240, width: 20, height: 20, collected: false },
            { x: 750, y: 120, width: 20, height: 20, collected: false },
          ],
          finishLine: { x: 750, y: 120, width: 30, height: 40 },
        },
        // å…³å¡5ï¼šæœ€ç»ˆå…³å¡
        {
          platforms: [
            { x: 0, y: 360, width: 60, height: 40 },
            { x: 110, y: 300, width: 60, height: 40 },
            { x: 220, y: 240, width: 60, height: 40 },
            { x: 330, y: 300, width: 60, height: 40 },
            { x: 440, y: 200, width: 60, height: 40 },
            { x: 550, y: 280, width: 60, height: 40 },
            { x: 660, y: 180, width: 60, height: 40 },
            { x: 750, y: 140, width: 50, height: 40 },
            { x: 0, y: 360, width: 800, height: 40 }, // åœ°é¢
          ],
          enemies: [
            { x: 160, y: 260, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
            { x: 270, y: 200, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
            { x: 380, y: 260, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
            { x: 490, y: 160, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
            { x: 600, y: 240, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
            { x: 710, y: 140, width: 25, height: 25, velocityX: -3, color: '#8B4513' },
          ],
          coins: [
            { x: 140, y: 260, width: 20, height: 20, collected: false },
            { x: 250, y: 200, width: 20, height: 20, collected: false },
            { x: 360, y: 260, width: 20, height: 20, collected: false },
            { x: 470, y: 160, width: 20, height: 20, collected: false },
            { x: 580, y: 240, width: 20, height: 20, collected: false },
            { x: 690, y: 140, width: 20, height: 20, collected: false },
            { x: 760, y: 100, width: 20, height: 20, collected: false },
          ],
          finishLine: { x: 750, y: 100, width: 30, height: 40 },
        },
      ];

      // å½“å‰å…³å¡æ•°æ®
      let platforms = [];
      let enemies = [];
      let coins = [];
      let finishLine = null;

      // é”®ç›˜çŠ¶æ€
      const keys = {};

      // åŠ è½½å…³å¡
      function loadLevel(levelNumber) {
        if (levelNumber > totalLevels) {
          gameRunning = false;
          playLevelCompleteSound(); // æ’­æ”¾å®Œæˆæ‰€æœ‰å…³å¡éŸ³æ•ˆ
          alert('ğŸ‰ æ­å–œï¼ä½ å®Œæˆäº†æ‰€æœ‰å…³å¡ï¼æœ€ç»ˆå¾—åˆ†: ' + score);
          return;
        }

        const level = levels[levelNumber - 1];
        platforms = JSON.parse(JSON.stringify(level.platforms));
        enemies = JSON.parse(JSON.stringify(level.enemies));
        coins = JSON.parse(JSON.stringify(level.coins));
        finishLine = JSON.parse(JSON.stringify(level.finishLine));

        // é‡ç½®ç©å®¶ä½ç½®
        player.x = 50;
        player.y = 300;
        player.velocityX = 0;
        player.velocityY = 0;
        player.onGround = false;

        currentLevel = levelNumber;
        currentLevelElement.textContent = currentLevel;
        levelCompleteElement.style.display = 'none';
        levelCompletePending = false;
      }

      // å…³å¡å®Œæˆæ ‡å¿—
      let levelCompletePending = false;

      // æ£€æŸ¥å…³å¡å®Œæˆ
      function checkLevelComplete() {
        // å¦‚æœå·²ç»åœ¨ç­‰å¾…å…³å¡å®Œæˆç¡®è®¤ï¼Œä¸å†æ£€æŸ¥
        if (levelCompletePending) return;

        // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç»ˆç‚¹
        if (finishLine && checkCollision(player, finishLine)) {
          levelCompletePending = true;
          levelCompleteElement.style.display = 'block';
          gameRunning = false;
          playLevelCompleteSound(); // æ’­æ”¾å…³å¡å®ŒæˆéŸ³æ•ˆ

          // ç­‰å¾…æŒ‰é”®ç»§ç»­
          const continueHandler = (e) => {
            e.preventDefault();
            document.removeEventListener('keydown', continueHandler);
            levelCompleteElement.style.display = 'none';
            levelCompletePending = false;
            loadLevel(currentLevel + 1);
            gameRunning = true;
            gameLoop();
          };
          document.addEventListener('keydown', continueHandler, { once: true });
        }
      }

      // é”®ç›˜äº‹ä»¶ç›‘å¬
      document.addEventListener('keydown', (e) => {
        keys[e.code] = true;
        if (e.code === 'Space') {
          e.preventDefault();
          if (player.onGround) {
            player.velocityY = player.jumpPower;
            player.onGround = false;
            playJumpSound(); // æ’­æ”¾è·³è·ƒéŸ³æ•ˆ
          }
        }
      });

      document.addEventListener('keyup', (e) => {
        keys[e.code] = false;
      });

      // ç¢°æ’æ£€æµ‹
      function checkCollision(rect1, rect2) {
        return (
          rect1.x < rect2.x + rect2.width &&
          rect1.x + rect1.width > rect2.x &&
          rect1.y < rect2.y + rect2.height &&
          rect1.y + rect1.height > rect2.y
        );
      }

      // æ£€æŸ¥ç©å®¶æ˜¯å¦åœ¨å¹³å°ä¸Š
      function checkPlatformCollision() {
        player.onGround = false;

        for (let platform of platforms) {
          // æ£€æŸ¥æ˜¯å¦åœ¨å¹³å°ä¸Šæ–¹ï¼ˆå¢åŠ å®¹é”™èŒƒå›´åˆ°8åƒç´ ï¼‰
          if (
            player.x + player.width > platform.x &&
            player.x < platform.x + platform.width &&
            player.y + player.height <= platform.y + 8 &&
            player.y + player.height >= platform.y - 8 &&
            player.velocityY >= 0
          ) {
            player.y = platform.y - player.height;
            player.velocityY = 0;
            player.onGround = true;
            break;
          }
        }
      }

      // æ›´æ–°ç©å®¶ä½ç½®
      function updatePlayer() {
        // æ°´å¹³ç§»åŠ¨
        if (keys['ArrowLeft']) {
          player.velocityX = -player.speed;
        } else if (keys['ArrowRight']) {
          player.velocityX = player.speed;
        } else {
          player.velocityX *= 0.8; // æ‘©æ“¦åŠ›
        }

        // åº”ç”¨é‡åŠ›
        if (!player.onGround) {
          player.velocityY += 0.6; // é‡åŠ›åŠ é€Ÿåº¦
        }

        // é™åˆ¶æœ€å¤§ä¸‹è½é€Ÿåº¦
        player.velocityY = Math.min(player.velocityY, 15);

        // æ›´æ–°ä½ç½®
        player.x += player.velocityX;
        player.y += player.velocityY;

        // è¾¹ç•Œæ£€æµ‹
        if (player.x < 0) player.x = 0;
        if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
        if (player.y > canvas.height) {
          // æ‰å‡ºå±å¹•ï¼Œé‡ç½®åˆ°å…³å¡èµ·å§‹ä½ç½®
          player.x = 50;
          player.y = 300;
          player.velocityY = 0;
          player.velocityX = 0;
          lives--;
          livesElement.textContent = lives;
          playHurtSound(); // æ’­æ”¾å—ä¼¤éŸ³æ•ˆ
          if (lives <= 0) {
            gameRunning = false;
            playGameOverSound(); // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
            alert('æ¸¸æˆç»“æŸï¼æœ€ç»ˆå¾—åˆ†: ' + score + ' | å®Œæˆå…³å¡: ' + (currentLevel - 1));
          }
        }

        checkPlatformCollision();
      }

      // æ›´æ–°æ•Œäºº
      function updateEnemies() {
        for (let enemy of enemies) {
          enemy.x += enemy.velocityX;

          // æ•Œäººè¾¹ç•Œæ£€æµ‹å’Œè½¬å‘
          let onPlatform = false;
          for (let platform of platforms) {
            if (
              enemy.x + enemy.width > platform.x &&
              enemy.x < platform.x + platform.width &&
              enemy.y + enemy.height <= platform.y + 5 &&
              enemy.y + enemy.height >= platform.y - 5
            ) {
              onPlatform = true;
              break;
            }
          }

          if (!onPlatform || enemy.x < 0 || enemy.x + enemy.width > canvas.width) {
            enemy.velocityX *= -1;
          }

          // æ£€æŸ¥ä¸ç©å®¶ç¢°æ’
          if (checkCollision(player, enemy)) {
            // å¦‚æœç©å®¶ä»ä¸Šæ–¹è¸©åˆ°æ•Œäºº
            if (player.velocityY > 0 && player.y < enemy.y) {
              // ç§»é™¤æ•Œäºº
              const index = enemies.indexOf(enemy);
              enemies.splice(index, 1);
              score += 100;
              scoreElement.textContent = score;
              player.velocityY = -5; // å°å¼¹è·³
              playStompSound(); // æ’­æ”¾è¸©æ•ŒäººéŸ³æ•ˆ
            } else {
              // ç©å®¶å—ä¼¤
              player.x = 50;
              player.y = 300;
              player.velocityY = 0;
              player.velocityX = 0;
              lives--;
              livesElement.textContent = lives;
              playHurtSound(); // æ’­æ”¾å—ä¼¤éŸ³æ•ˆ
              if (lives <= 0) {
                gameRunning = false;
                playGameOverSound(); // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
                alert('æ¸¸æˆç»“æŸï¼æœ€ç»ˆå¾—åˆ†: ' + score + ' | å®Œæˆå…³å¡: ' + (currentLevel - 1));
              }
            }
          }
        }
      }

      // æ›´æ–°é‡‘å¸
      function updateCoins() {
        for (let coin of coins) {
          if (!coin.collected && checkCollision(player, coin)) {
            coin.collected = true;
            score += 50;
            scoreElement.textContent = score;
            playCoinSound(); // æ’­æ”¾æ”¶é›†é‡‘å¸éŸ³æ•ˆ
          }
        }
      }

      // ç»˜åˆ¶å‡½æ•°
      function drawPlayer() {
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.width, player.height);

        // ç®€å•çš„çœ¼ç›
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(player.x + 8, player.y + 10, 5, 5);
        ctx.fillRect(player.x + 17, player.y + 10, 5, 5);
      }

      function drawPlatforms() {
        ctx.fillStyle = '#228B22';
        for (let platform of platforms) {
          ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
          // æ·»åŠ çº¹ç†
          ctx.fillStyle = '#32CD32';
          ctx.fillRect(platform.x, platform.y, platform.width, 5);
          ctx.fillStyle = '#228B22';
        }
      }

      function drawEnemies() {
        for (let enemy of enemies) {
          ctx.fillStyle = enemy.color;
          ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
          // ç®€å•çš„çœ¼ç›
          ctx.fillStyle = '#FFFFFF';
          ctx.fillRect(enemy.x + 5, enemy.y + 5, 5, 5);
          ctx.fillRect(enemy.x + 15, enemy.y + 5, 5, 5);
          ctx.fillStyle = enemy.color;
        }
      }

      function drawCoins() {
        for (let coin of coins) {
          if (!coin.collected) {
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(
              coin.x + coin.width / 2,
              coin.y + coin.height / 2,
              coin.width / 2,
              0,
              Math.PI * 2,
            );
            ctx.fill();
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 2;
            ctx.stroke();
          }
        }
      }

      function drawBackground() {
        // å¤©ç©ºæ¸å˜
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, '#87CEEB');
        gradient.addColorStop(1, '#E0F6FF');
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // äº‘æœµ
        ctx.fillStyle = '#FFFFFF';
        ctx.beginPath();
        ctx.arc(150, 80, 30, 0, Math.PI * 2);
        ctx.arc(170, 80, 35, 0, Math.PI * 2);
        ctx.arc(190, 80, 30, 0, Math.PI * 2);
        ctx.fill();

        ctx.beginPath();
        ctx.arc(500, 60, 25, 0, Math.PI * 2);
        ctx.arc(515, 60, 30, 0, Math.PI * 2);
        ctx.arc(530, 60, 25, 0, Math.PI * 2);
        ctx.fill();
      }

      function drawFinishLine() {
        if (!finishLine) return;

        // ç»˜åˆ¶ç»ˆç‚¹æ——æ†
        ctx.fillStyle = '#8B4513';
        ctx.fillRect(finishLine.x + 10, finishLine.y, 5, finishLine.height);

        // ç»˜åˆ¶ç»ˆç‚¹æ——
        ctx.fillStyle = '#FF0000';
        ctx.beginPath();
        ctx.moveTo(finishLine.x + 15, finishLine.y);
        ctx.lineTo(finishLine.x + 15, finishLine.y + 15);
        ctx.lineTo(finishLine.x + 30, finishLine.y + 7);
        ctx.closePath();
        ctx.fill();

        // ç»˜åˆ¶ç»ˆç‚¹æ ‡å¿—
        ctx.fillStyle = '#FFFF00';
        ctx.font = 'bold 20px Arial';
        ctx.fillText('ğŸ', finishLine.x, finishLine.y - 10);
      }

      // æ¸¸æˆå¾ªç¯
      function gameLoop() {
        if (!gameRunning) return;

        // æ¸…ç©ºç”»å¸ƒ
        drawBackground();

        // æ›´æ–°æ¸¸æˆå¯¹è±¡
        updatePlayer();
        updateEnemies();
        updateCoins();

        // æ£€æŸ¥å…³å¡å®Œæˆ
        checkLevelComplete();

        // ç»˜åˆ¶æ¸¸æˆå¯¹è±¡
        drawPlatforms();
        drawCoins();
        drawEnemies();
        drawFinishLine();
        drawPlayer();

        requestAnimationFrame(gameLoop);
      }

      // åˆå§‹åŒ–æ¸¸æˆ
      loadLevel(1);

      // å¼€å§‹æ¸¸æˆ
      gameLoop();
    </script>
  </body>
</html>

